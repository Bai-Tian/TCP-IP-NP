# 优雅地断开套接字连接

## 基于TCP的半关闭

### 单方面断开连接带来的问题

Linux的`close()`函数意味着完全断开连接，完全断开后，套接字既无法传输数据，也无法接收数据。

### 套接字和流

一旦两台主机建立了套接字连接，每个主机就会拥有单独的输入流与输出流。一个主机的输入流与另一台主机的输出流相连，输出流与另一台主机的输入流相连。

### 半关闭函数shutdown()

```c
#include <sys/socket.h>
int shutdown(int sock, int howto);

返回：
	成功：0
	失败：-1
```

- sock：需要断开的套接字文件描述符
- howto：断开方式[SHUT_RD（断开输入流）| SHUT_WR（断开输出流）| SHUT_RDWR（同时断开I/O流）]